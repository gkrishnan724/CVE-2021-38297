<!DOCTYPE html>
<html>

<head>
    <title>Go WebAssembly Example</title>
    <script src="wasm_exec.js"></script>
</head>

<body>
    <script>
        let isWasmInit = false;
        let goExp;

        const initializeWASM = function() {

            console.log("WASM INITIALIZED!");

            const someInput = document.getElementById('argv').value;

            const go = new Go();
            WebAssembly.instantiateStreaming(fetch('main.wasm'), go.importObject).then((result) => {
                go.argv = ['js',someInput]; //Pass argv
                go.run(result.instance);
                console.log(result.instance.exports);
                goExp = result.instance.exports;
            });

            isWasmInit = true;
        }
        

        function addNumbers() {

            if (!isWasmInit) {
                console.log("WASM not initialized!!! Init WASM first");
                return;
            }
            const num1 = document.getElementById('num1').value;
            const num2 = document.getElementById('num2').value;

            const result = add(parseFloat(num1), parseFloat(num2));
            document.getElementById('result').innerText = `Result: ${result}`;
        }
    </script>

    <label for="argv">Argv:</label>
    <input type="text" id="argv"><br>
    <button onclick = "initializeWASM()">Initialize WASM!</button><br>

    <label for="num1">Number 1:</label>
    <input type="number" id="num1"><br>

    <label for="num2">Number 2:</label>
    <input type="number" id="num2"><br>

    <button onclick="addNumbers()">Add Numbers</button><br>
    <button onclick="printGlobal()">Print Global val</button>

    <div id="result"></div>
</body>

</html>
